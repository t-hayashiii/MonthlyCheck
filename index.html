<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<title>ç¿’æ…£è¨˜éŒ²</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
  body { overflow-x: hidden; }

  /* ã‚¹ãƒãƒ›æœ€é©åŒ– */
  @media (max-width: 640px) {
    .calendar-cell { height: 110px !important; }
    .day-number { font-size: 15px !important; }
    .day-ex-item { font-size: 10px !important; }
    .content-wrap { padding: 0.5rem !important; }
  }

  .dragging { opacity: 0.4; }
</style>
</head>

<body class="bg-gray-100 text-gray-800">

<!-- ================================ -->
<!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
<!-- ================================ -->
<div id="mainScreen">

<header class="bg-blue-600 text-white py-4 text-center text-xl font-bold">
  ç¿’æ…£è¨˜éŒ²
</header>

<!-- ä¸Šéƒ¨ã®ç®¡ç†ãƒœã‚¿ãƒ³ -->
<div class="max-w-3xl mx-auto p-4 flex justify-end">
  <button id="openManageBtn" class="text-blue-600 underline font-bold">
    ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã¸
  </button>
</div>

<div class="max-w-3xl mx-auto p-4 content-wrap">

  <!-- ========== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ========== -->
  <div id="calendarArea" class="bg-white shadow rounded p-4 mb-6">

    <div class="flex justify-between items-center mb-2">
      <button id="prevMonthBtn" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded">
        &lt; å‰ã®æœˆ
      </button>

      <!-- æœˆã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ24pxï¼‰ -->
      <h2 id="calendarTitle" class="text-2xl font-bold"></h2>

      <button id="nextMonthBtn" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded">
        æ¬¡ã®æœˆ &gt;
      </button>
    </div>

    <div class="grid grid-cols-7 text-center font-bold border-b pb-1 text-sm">
      <div>æœˆ</div><div>ç«</div><div>æ°´</div>
      <div>æœ¨</div><div>é‡‘</div><div>åœŸ</div><div>æ—¥</div>
    </div>

    <div id="calendarGrid" class="grid grid-cols-7 gap-1 mt-2"></div>
  </div>

  <!-- ========== é¸æŠæ—¥ã®è©³ç´° ========== -->
  <div id="detailArea" class="bg-white shadow rounded p-4 mb-6">
    <h2 id="detailTitle" class="text-lg font-bold mb-3"></h2>
    <div id="exerciseList" class="space-y-2"></div>
  </div>

</div><!-- wrapper -->

</div><!-- /mainScreen -->
<!-- ================================ -->
<!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ç”»é¢ -->
<!-- ================================ -->
<div id="manageScreen" class="hidden">

<header class="bg-blue-600 text-white py-4 text-center text-xl font-bold">
  ç¿’æ…£è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ç®¡ç†
</header>

<!-- ãƒ¡ã‚¤ãƒ³ã«æˆ»ã‚‹ï¼ˆå·¦å¯„ã›ï¼‰ -->
<div class="max-w-3xl mx-auto p-4 flex justify-start">
  <button id="closeManageBtn" class="text-blue-600 underline font-bold">
    ãƒ¡ã‚¤ãƒ³ã«æˆ»ã‚‹
  </button>
</div>

<div class="max-w-3xl mx-auto p-4">

  <!-- ç¿’æ…£ä¸€è¦§ï¼ˆãƒ‰ãƒ©ãƒƒã‚°å¯¾å¿œï¼‰ -->
  <div id="exerciseMasterList" class="space-y-3 mb-6"></div>

  <!-- æ–°è¦è¿½åŠ  -->
  <button id="openNewDialog"
          class="px-4 py-2 bg-blue-500 text-white rounded font-bold">
    æ–°è¦è¿½åŠ 
  </button>

  <hr class="my-6"/>

  <!-- ğŸ”¥ èµ¤ãƒœã‚¿ãƒ³ï¼’ã¤ã‚’æ¨ªä¸¦ã³ã« -->
  <div class="flex space-x-4">

    <!-- åˆæœŸåŒ–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™ï¼‰ -->
    <button id="resetDataBtn" 
            class="px-4 py-2 bg-red-500 text-white rounded font-bold">
      å…¨ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã™ã‚‹
    </button>

    <!-- å…¨å‰Šé™¤ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚’ç©ºã«ã™ã‚‹ï¼‰ -->
    <button id="deleteAllExercisesBtn"
            class="px-4 py-2 bg-red-500 text-white rounded font-bold">
      å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹
    </button>

  </div>

</div>
</div><!-- /manageScreen -->



<!-- ================================ -->
<!-- æ–°è¦ / ä¿®æ­£ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
<!-- ================================ -->
<div id="editDialog" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden">
  <div class="bg-white p-6 rounded shadow w-80">

    <h2 id="dialogTitle" class="font-bold text-lg mb-4"></h2>

    <!-- ç¿’æ…£å -->
    <input id="dlgName" class="border p-1 w-full mb-3 text-sm" placeholder="ç¿’æ…£å" />

    <!-- æ›œæ—¥ãƒœã‚¿ãƒ³ -->
    <div class="mb-1 text-sm font-bold">è¡Œã†æ›œæ—¥</div>
    <div id="dlgWeekBtns" class="flex flex-wrap gap-1 mb-3"></div>

    <!-- å‹•ç”»ãƒªãƒ³ã‚¯ -->
    <input id="dlgLink" 
           class="border p-1 w-full mb-4 text-sm" 
           placeholder="å‹•ç”»ãƒªãƒ³ã‚¯ URLï¼ˆä»»æ„ï¼‰" />

    <div class="flex justify-end space-x-2">
      <button id="dlgCancel" class="px-3 py-1 bg-gray-300 rounded font-bold">
        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
      </button>
      <button id="dlgSave" class="px-3 py-1 bg-blue-500 text-white rounded font-bold">
        ä¿å­˜
      </button>
    </div>

  </div>
</div>
<script>
/* ================================
   ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ I/O
================================ */
function loadExercises() {
  return JSON.parse(localStorage.getItem("exerciseMaster") || "null");
}
function saveExercises(data) {
  localStorage.setItem("exerciseMaster", JSON.stringify(data));
}

function loadRecords() {
  return JSON.parse(localStorage.getItem("exerciseRecords") || "{}");
}
function saveRecords(data) {
  localStorage.setItem("exerciseRecords", JSON.stringify(data));
}

/* ================================
   åˆæœŸãƒ‡ãƒ¼ã‚¿
================================ */
const defaultExercises = [
    { name: "ç›®", days: ["æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ","æ—¥"], link: "" },
    { name: "ãƒ©ã‚¸ã‚ªä½“æ“", days: ["æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ","æ—¥"], link: "https://www.google.com/url?q=https://youtu.be/5NCSDYUhVY8?si%3DVg92LeOVzkG53yHI&sa=D&source=calendar&ust=1765535261516433&usg=AOvVaw2NxranAVuknWsXhUMoaP8a" },
    { name: "ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ", days: ["æœˆ","æ°´","é‡‘"], link: "https://www.google.com/url?q=https://youtu.be/Wjp7V0EK0Zg?si%253DFnVu1yqsjGemglpA%26sa%3DD%26source%3Dcalendar%26usd%3D2%26usg%3DAOvVaw0i482eBBckc_8rJ1dMkKNX&sa=D&source=calendar&ust=1765535261516433&usg=AOvVaw1p51R4Ne44s14LnP2qOlSR" },
    { name: "ãƒ—ãƒ©ãƒ³ã‚¯1", days: ["æœˆ","æ°´","é‡‘","æ—¥"], link: "https://www.google.com/url?q=https://youtu.be/UgkU2S8VUX4?si%253DlMcurdkGoe3LYtX0%26sa%3DD%26source%3Dcalendar%26usd%3D2%26usg%3DAOvVaw2u6jsjRys0jjXpw_R6Bgiz&sa=D&source=calendar&ust=1765535261516433&usg=AOvVaw0GMyk42upA7aYsSCknopJ_" },
    { name: "ãƒ—ãƒ©ãƒ³ã‚¯2", days: ["æœˆ","æ°´","é‡‘","æ—¥"], link: "https://www.google.com/url?q=https://youtu.be/AKUGmosS7fM?si%253DX-1u96UYF15BW13t%26sa%3DD%26source%3Dcalendar%26usd%3D2%26usg%3DAOvVaw2ovODt0bbozwsRzRcM06Ey&sa=D&source=calendar&ust=1765535261516433&usg=AOvVaw1XTFZWjmvCG7F-U8tHdJ6K" },
    { name: "ãƒ‹ãƒ¼ãƒˆã‚¥ãƒã‚§ã‚¹ãƒˆ", days: ["æœˆ","æ°´","é‡‘"], link: "https://www.google.com/url?q=https://youtu.be/BNsM_aI0aBo?si%253DWu5i1ttjg378I2Wc%26sa%3DD%26source%3Dcalendar%26usd%3D2%26usg%3DAOvVaw3xGp8DOfh5WHLwaXmQ0rUJ&sa=D&source=calendar&ust=1765535261516433&usg=AOvVaw0jOVE_J38qBG8SpsmpVpXm" },
    { name: "è…•ç«‹ã¦ä¼ã›", days: ["ç«","æœ¨","åœŸ"], link: "https://www.google.com/url?q=https://youtu.be/IdQESpQE9ew?si%253DHSWmv9B0zcfw_76p%26sa%3DD%26source%3Dcalendar%26usd%3D2%26usg%3DAOvVaw2JmAu2mvttS2EqXgs1NNY3&sa=D&source=calendar&ust=1765535261516433&usg=AOvVaw1dXT6NkqvBtX6Uut1fFn5O" },
    { name: "éšæ®µæ˜‡é™", days: ["ç«","æœ¨","åœŸ"], link: "https://www.google.com/url?q=https://youtu.be/cTUwn1fgo9M?si%253DRK0krmZ0Svc6b4Ls%26sa%3DD%26source%3Dcalendar%26usd%3D2%26usg%3DAOvVaw1yMm6qk5JOYfx4wUQAM9dW&sa=D&source=calendar&ust=1765535261516433&usg=AOvVaw3m80gJoQydNfnOuri-W51r" },
    { name: "ã‚¹ãƒˆãƒ¬ãƒƒãƒ", days: ["æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ","æ—¥"], link: "https://www.google.com/url?q=https://youtu.be/anHktHYc3cA?si%3DjnMkhd3SFOvV4YNs&sa=D&source=calendar&ust=1765541889314197&usg=AOvVaw0PUIWvkPJ1bH86pSuyJFqX" }
];

/* ================================
   ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
================================ */
let exerciseMaster = loadExercises();
if (!exerciseMaster) {
  exerciseMaster = JSON.parse(JSON.stringify(defaultExercises));
  saveExercises(exerciseMaster);
}

let exerciseRecords = loadRecords();

let currentDate = new Date();
let selectedDate = new Date();

/* ================================
   ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»
================================ */
function buildCalendar() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();

  document.getElementById("calendarTitle").textContent =
    `${year}å¹´ ${month + 1}æœˆ`;

  const firstDay = new Date(year, month, 1);
  const startWeek = (firstDay.getDay() + 6) % 7;

  const lastDay = new Date(year, month + 1, 0).getDate();

  const grid = document.getElementById("calendarGrid");
  grid.innerHTML = "";

  for (let i = 0; i < startWeek; i++) {
    const cell = document.createElement("div");
    cell.className = "calendar-cell h-32 border rounded bg-white";
    grid.appendChild(cell);
  }

  for (let d = 1; d <= lastDay; d++) {
    const date = new Date(year, month, d);
    const wday = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][date.getDay()];

    const cell = document.createElement("div");
    cell.className =
      "calendar-cell h-32 border rounded bg-white overflow-hidden p-1 cursor-pointer hover:bg-blue-50";

    cell.onclick = () => {
      selectedDate = date;
      showDetail(date);
    };

    const title = document.createElement("div");
    title.className = "day-number font-bold mb-1 text-[15px]";
    title.textContent = d;
    cell.appendChild(title);

    exerciseMaster.forEach(ex => {
      if (ex.days.includes(wday)) {
        const div = document.createElement("div");
        div.className = "day-ex-item text-[10px] leading-tight";
        div.classList.add("text-gray-400"); // â† è¿½åŠ 
        div.textContent = ex.name;

        const key = date.toISOString().slice(0,10);
        const rec = exerciseRecords[key]?.[ex.name];
        if (rec?.done) {
        div.classList.remove("text-gray-400");
        div.classList.add("text-blue-600", "font-bold");
        }

        cell.appendChild(div);
      }
    });

    grid.appendChild(cell);
  }
}

document.getElementById("prevMonthBtn").onclick = () => {
  currentDate.setMonth(currentDate.getMonth() - 1);
  buildCalendar();
};
document.getElementById("nextMonthBtn").onclick = () => {
  currentDate.setMonth(currentDate.getMonth() + 1);
  buildCalendar();
};

/* ================================
   è©³ç´°è¡¨ç¤º
================================ */
function showDetail(date) {
  const y = date.getFullYear();
  const m = date.getMonth() + 1;
  const d = date.getDate();
  const w = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][date.getDay()];

  document.getElementById("detailTitle").textContent =
    `${m}æœˆ${d}æ—¥ï¼ˆ${w}ï¼‰ ã®ç¿’æ…£`;

  const list = document.getElementById("exerciseList");
  list.innerHTML = "";

  exerciseMaster.forEach(ex => {
    if (!ex.days.includes(w)) return;

    const row = document.createElement("div");
    row.className = "flex items-center bg-blue-50/40 rounded p-2";

    const key = date.toISOString().slice(0,10);
    const rec = exerciseRecords[key]?.[ex.name];

    const chk = document.createElement("input");
    chk.type = "checkbox";
    chk.checked = rec?.done ? true : false;
    chk.className = "w-5 h-5 mr-3";

    const name = document.createElement("span");
    name.textContent = ex.name;
    name.className = "mr-3";

    if (rec?.done) {
      name.classList.add("font-bold", "text-blue-700");
      row.classList.add("bg-blue-50");
    }

    const time = document.createElement("span");
    time.className = "text-sm text-gray-600";
    time.textContent = rec?.time ? rec.time : "";

    chk.onchange = () => {
      if (!exerciseRecords[key]) exerciseRecords[key] = {};

      if (chk.checked) {
        const now = new Date();
        const t = `${now.getHours()}:${String(now.getMinutes()).padStart(2,"0")}`;
        exerciseRecords[key][ex.name] = { done: true, time: t };
      } else {
        delete exerciseRecords[key][ex.name];
      }
      saveRecords(exerciseRecords);
      showDetail(date);
      buildCalendar();
    };

    row.appendChild(chk);
    row.appendChild(name);
    if (ex.link) {
      const btn = document.createElement("a");
      btn.href = ex.link;
      btn.target = "_blank";
      btn.textContent = "å‹•ç”»";
      btn.className =
        "px-2 py-1 text-xs bg-gray-300 rounded mr-3 hover:bg-gray-400";
      row.appendChild(btn);
    }
    row.appendChild(time);

    list.appendChild(row);
  });
}

/* ================================
   ãƒ‡ãƒ¼ã‚¿ç®¡ç†ç”»é¢
================================ */
document.getElementById("openManageBtn").onclick = () => {
  document.getElementById("mainScreen").classList.add("hidden");
  document.getElementById("manageScreen").classList.remove("hidden");
  refreshManageList();
};

document.getElementById("closeManageBtn").onclick = () => {
  document.getElementById("manageScreen").classList.add("hidden");
  document.getElementById("mainScreen").classList.remove("hidden");
  buildCalendar();
  showDetail(selectedDate);
};

/* --- ç¿’æ…£ä¸€è¦§ç”Ÿæˆï¼ˆãƒ‰ãƒ©ãƒƒã‚°å¯¾å¿œï¼‰ --- */
function refreshManageList() {
  const list = document.getElementById("exerciseMasterList");
  list.innerHTML = "";

  exerciseMaster.forEach((ex, idx) => {
    const row = document.createElement("div");
    row.draggable = true;
    row.dataset.index = idx;
    row.className =
      "border bg-white p-3 rounded shadow flex items-center justify-between";

    row.ondragstart = e => {
      e.dataTransfer.setData("text/plain", idx);
      row.classList.add("dragging");
    };
    row.ondragend = () => row.classList.remove("dragging");

    row.ondragover = e => e.preventDefault();
    row.ondrop = e => {
      e.preventDefault();
      const from = Number(e.dataTransfer.getData("text/plain"));
      const to = idx;
      const temp = exerciseMaster[from];
      exerciseMaster.splice(from,1);
      exerciseMaster.splice(to,0,temp);
      saveExercises(exerciseMaster);
      refreshManageList();
    };

    const left = document.createElement("div");
    left.innerHTML =
      `<div class="font-bold text-lg">${ex.name}</div>
       <div class="text-sm text-gray-600">æ›œæ—¥ï¼š${ex.days.join("")}</div>`;

    const right = document.createElement("div");
    right.className = "flex space-x-2";

    const editBtn = document.createElement("button");
    editBtn.textContent = "ä¿®æ­£";
    editBtn.className = "px-3 py-1 bg-green-500 text-white rounded font-bold";
    editBtn.onclick = () => openEditDialog(idx);

    const delBtn = document.createElement("button");
    delBtn.textContent = "å‰Šé™¤";
    delBtn.className = "px-3 py-1 bg-red-500 text-white rounded font-bold";
    delBtn.onclick = () => {
      if (confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
        exerciseMaster.splice(idx,1);
        saveExercises(exerciseMaster);
        refreshManageList();
        buildCalendar();
        showDetail(selectedDate);
      }
    };

    right.appendChild(editBtn);
    right.appendChild(delBtn);

    row.appendChild(left);
    row.appendChild(right);
    list.appendChild(row);
  });
}

/* ================================
   æ–°è¦ / ä¿®æ­£ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
================================ */
const dialog = document.getElementById("editDialog");
let editingIndex = null;

document.getElementById("openNewDialog").onclick = () => {
  editingIndex = null;
  openDialog("æ–°è¦è¿½åŠ ");
};

function openEditDialog(idx) {
  editingIndex = idx;
  openDialog("ä¿®æ­£", exerciseMaster[idx]);
}

function openDialog(title, data=null) {
  document.getElementById("dialogTitle").textContent = title;

  document.getElementById("dlgName").value = data?.name || "";
  document.getElementById("dlgLink").value = data?.link || "";

  const days = ["æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ","æ—¥"];
  const area = document.getElementById("dlgWeekBtns");
  area.innerHTML = "";

  days.forEach(d => {
    const b = document.createElement("button");
    b.textContent = d;
    b.className =
      "px-2 py-1 border rounded text-sm " +
      (data?.days.includes(d) ? "bg-blue-500 text-white" :
                                "bg-gray-200 text-gray-700");

    b.onclick = () => {
      if (b.classList.contains("bg-blue-500")) {
        b.classList.remove("bg-blue-500","text-white");
        b.classList.add("bg-gray-200","text-gray-700");
      } else {
        b.classList.remove("bg-gray-200","text-gray-700");
        b.classList.add("bg-blue-500","text-white");
      }
    };

    area.appendChild(b);
  });

  dialog.classList.remove("hidden");
}

document.getElementById("dlgCancel").onclick = () => {
  dialog.classList.add("hidden");
};

document.getElementById("dlgSave").onclick = () => {
  const name = document.getElementById("dlgName").value.trim();
  if (!name) {
    alert("ç¿’æ…£åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }
  const link = document.getElementById("dlgLink").value.trim();

  const days = [];
  document.querySelectorAll("#dlgWeekBtns button").forEach(b => {
    if (b.classList.contains("bg-blue-500")) days.push(b.textContent);
  });

  const item = { name, link, days };

  if (editingIndex == null) {
    exerciseMaster.push(item);
  } else {
    exerciseMaster[editingIndex] = item;
  }
  saveExercises(exerciseMaster);

  dialog.classList.add("hidden");
  refreshManageList();
  buildCalendar();
  showDetail(selectedDate);
};

/* ================================
   åˆæœŸåŒ–ãƒœã‚¿ãƒ³ï¼ˆæ—¢å­˜ï¼‰
================================ */
document.getElementById("resetDataBtn").onclick = () => {
  if (confirm("ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ")) {
    exerciseMaster = JSON.parse(JSON.stringify(defaultExercises));
    exerciseRecords = {};
    saveExercises(exerciseMaster);
    saveRecords(exerciseRecords);
    refreshManageList();
    buildCalendar();
    showDetail(new Date());
  }
};

/* ================================
   â˜… å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼ˆä»Šå›è¿½åŠ ï¼‰
================================ */
document.getElementById("deleteAllExercisesBtn").onclick = () => {
  if (confirm("ç™»éŒ²æ¸ˆã¿ã®ç¿’æ…£ãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
    exerciseMaster = [];
    exerciseRecords = {};
    saveExercises(exerciseMaster);
    saveRecords(exerciseRecords);
    refreshManageList();
    buildCalendar();
    showDetail(selectedDate);
    alert("ã™ã¹ã¦ã®ç¿’æ…£ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
  }
};

/* ================================
   åˆæœŸæç”»
================================ */
buildCalendar();
showDetail(selectedDate);
</script>

</body>
</html>
